define(["jquery","core/str","local_edwiserreports/defaultconfig","local_edwiserreports/variables","local_edwiserreports/flatpickr","local_edwiserreports/jquery.dataTables","local_edwiserreports/dataTables.bootstrap4"],(function(e,t,a,o){var r=null,n=a.getPanel("#customReportBlock"),l=n+" .dropdown-menu .dropdown-item",s="courses",i=n+" #customReportDownload",d=e(n).find("#customReportDrodown"),c=e(n).find("#customReportsForm"),u="local_edwiserreports",m=(t.get_strings([{key:"customreportselectfailed",component:u},{key:"customreportdatefailed",component:u}]),function(e){return n+" "+e+" input[name^=customReportSelect-]"});e(n).find(".custom-flatpicker").flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:"today",onClose:function(t,a,o){if(t[0])if(e("#wdmCustomReportEnrolStart").is(o.element)){var r=t[0].getTime();c.find("input[name=enrolstartdate]").val(r/1e3)}else if(e("#wdmCustomReportEnrolEnd").is(o.element)){var n=t[0].getTime();c.find("input[name=enrolenddate]").val(n/1e3)}}}),e(document).on("click",".custom-flatpicker ~ button.input-search-close",(function(){e(".custom-flatpicker ~ input.form-control").val(""),c.find("input[name=enrolstartdate]").val(""),c.find("input[name=enrolenddate]").val("")})),e(document).on("change",n+' input[name="selectAllCustom"]',(function(t){var a=".course-table";"lps"==s&&(a=".lp-table");var o=m(a);e(t.target).is(":checked")?e(o).prop("checked",!0):e(o).prop("checked",!1)})),e(document).on("click",l,(function(t){e(t.target).closest(".dropdown");s=e(t.target).data("val"),d.html(e(t.target).html()),d.data("val",s);var a=".course-table";"lps"==s&&(a=".lp-table"),e(n).find(".table").hide(),c.find("input[name=reporttype]").val(s),function(t,a){r&&r.destroy(),e(n+" .enrol-selector").show(),e(n+' input[name="selectAllCustom"]').prop("checked",!1);var l=e(n).find(".customReportSelectors"),s=e(n).find(".rootContainer"),i=JSON.stringify({type:t}),d=o.requestUrl+"?action=get_customreport_selectors_ajax&sesskey="+M.cfg.sesskey+"&filter="+i;s.show();var c=function(e){return"lps"==e?{columns:[{data:"select"},{data:"fullname"},{data:"shortname"},{data:"startdate"},{data:"enddate"},{data:"duration"}],language:{searchPlaceholder:"Search Learning Programs",emptyTable:"There are no learning programs"}}:{columns:[{data:"select"},{data:"fullname"},{data:"shortname"},{data:"category"},{data:"startdate"},{data:"enddate"}],language:{searchPlaceholder:"Search Course",emptyTable:"There are no courses"}}}(t);r=l.find(a).show().DataTable({ajax:d,columns:c.columns,language:c.language,responsive:!0,scrollY:"380px",scroller:{loadingIndicator:!0},scrollCollapse:!0,scrollX:!0,paging:!1,bInfo:!1,bSort:!1}).columns.adjust()}(s,a)})),e(document).on("click",i,(function(t){if(a=c.find('input[name="enrolstartdate"]').val(),(""!=(o=c.find('input[name="enrolenddate"]').val())||""!=a)&&o<a)return e(n).find("#errorMsg").html(M.util.get_string("customreportdatefailed",u)).addClass("show").removeClass("hide"),setTimeout((function(){e(n).find("#errorMsg").addClass("hide").removeClass("show")}),5e3),!1;var a,o,r=".course-table";"lps"==s&&(r=".lp-table");var l=m(r);if(!e(l+":checked").length)return e(n).find("#errorMsg").html(M.util.get_string("customreportselectfailed",u)).addClass("show").removeClass("hide"),setTimeout((function(){e(n).find("#errorMsg").addClass("hide").removeClass("show")}),5e3),!1;filters=[],e(l+":checked").each((function(t,a){filters.push(e(a).data("id"))})),c.find("input[name=filters]").val(filters.join(","))}))}));
