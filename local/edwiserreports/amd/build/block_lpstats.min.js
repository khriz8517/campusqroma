define(["jquery","core/chartjs","local_edwiserreports/defaultconfig","local_edwiserreports/variables","local_edwiserreports/select2"],(function(a,e,t,l){return{init:function(s){var o=null,n=t.getPanel("#lpstatsblock"),r=t.getPanel("#lpstatsblock","body"),d=(t.getPanel("#lpstatsblock","title"),r+" #wdm-lpstats-select"),c=n+" .dropdown-menu[aria-labelledby='export-dropdown'] .dropdown-item",p=r+" .ct-chart",i=r+" .loader",g=!1;function u(l){a.ajax({url:t.requestUrl,type:t.requestType,dataType:t.requestDataType,sesskey:a(n).data("sesskey"),data:{action:"get_lpstats_data_ajax",sesskey:a(n).data("sesskey"),data:JSON.stringify({lpid:l})}}).done((function(a){!function(a){if(g){g.graph.labels=a.labels,g.graph.data=a.data;var t={labels:g.graph.labels,datasets:[{data:g.graph.data,backgroundColor:g.graph.backgroundColor}]};o=new e(g.ctx,{data:t,type:g.graph.type,options:g.graph.options})}}(a.data)})).fail((function(a){console.log(a)})).always((function(){a(i).addClass("d-none"),a(p).removeClass("d-none"),s("lpStatsBlock")}))}a(document).ready((function(){var e=a(d).val();(g=t.getLpStatsBlock())?(u(e),a(r+" .singleselect").select2(),a(d).on("change",(function(){e=a(this).val(),a(p).addClass("d-none"),a(i).removeClass("d-none"),t.changeExportUrl(e,c,l.filterReplaceFlag),o.destroy(),u(e)}))):s("lpStatsBlock")}))}}}));
